<?php
session_start();
$bdd = new PDO('mysql:host=localhost;dbname=membres;charset=utf8', 'root', 'root');

if(isset($_SESSION['id']))
{
        $requser = $bdd->prepare("SELECT * FROM users WHERE id =?");
        $requser->execute(array($_SESSION['id']));
        $user = $requser->fetch();
        

        if(isset($_POST['newmdp']) AND !empty($_POST['newmdp']) AND isset($_POST['newconfirmdp']) AND !empty($_POST['newconfirmdp']))
        {
                $mdp = sha1($_POST['newmdp']);
                $confirmdp = sha1($_POST['newconfirmdp']);
                if($mdp == $confirmdp)
                {
                        $insertmdp = $bdd->prepare("UPDATE users FROM mdp = ? WHERE id = ?");
                        $insertmdp->execute(array($mdp, $_SESSION['id']));
                        echo "mis à jour";
                }
                else{
                        $msg = "vos deux mdp ne correspondent pas";
                }
                
        }

?>
<!DOCTYPE html>
<html>
    <head>
    <meta charset = "utf-8" >

    </head>

<body>
        
        <h2>edition de mon mot de passe</h2>
        <form method="POST" action="">
        <label>nouveau mot de passe :</label>
        <input type="password" name="newmdp" placeholder="mdp" /><br />
        <label>confirmé le nouveau mot de passse:</label>
        <input type="password" name="newconfirmdp" placeholder="confirmdp" /><br />
        <input type="submit" value="confirmation de la mise à jour" />
        </form>
        <?php if(isset($msg)) {echo $msg; } ?>
        <div class="retour">
        <a href="indexhtml.html">retour à l'accueil</a>
        </div></br>
</body>
</html>
<?php
}
else
{
        header('Lcocation: index.php');
}

?>
